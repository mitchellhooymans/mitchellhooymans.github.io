<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Double Pendulum Simulation | Mitchell Hooymans</title>
    <meta name="description"
        content="Interactive double pendulum simulation using Lagrangian mechanics. Explore chaos theory and nonlinear dynamics in real-time.">
    <link rel="canonical" href="https://mitchellhooymans.com/simulations/pendulum.html" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://mitchellhooymans.com/simulations/pendulum.html">
    <meta property="og:title" content="Double Pendulum Simulation | Mitchell Hooymans">
    <meta property="og:description"
        content="Interactive double pendulum simulation using Lagrangian mechanics. Explore chaos theory and nonlinear dynamics in real-time.">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="../styles.css">
    <link rel="icon" type="image/png" sizes="32x32" href="../images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../images/favicon/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../images/favicon/apple-touch-icon.png">
    <link rel="manifest" href="../images/favicon/site.webmanifest">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        .content-section {
            max-width: 1000px;
            margin: 0 auto;
        }

        .simulation-wrapper {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--space-6);
        }

        @media (min-width: 900px) {
            .simulation-wrapper {
                grid-template-columns: 1fr 300px;
            }
        }

        .simulation-container {
            background: #000;
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow-xl);
            position: relative;
            width: 100%;
        }

        #simulationCanvas {
            display: block;
            width: 100%;
            height: 100%;
            aspect-ratio: 1/1;
            /* Square canvas for pendulum */
            background: radial-gradient(circle at center, #1a1a2e 0%, #050510 100%);
        }

        @media (min-width: 600px) {
            #simulationCanvas {
                aspect-ratio: 4/3;
            }
        }

        .sim-overlay {
            position: absolute;
            top: var(--space-3);
            left: var(--space-3);
            background: rgba(0, 0, 0, 0.7);
            border-radius: var(--radius-md);
            padding: var(--space-3);
            color: #fff;
            font-size: 0.75rem;
            font-family: 'Courier New', monospace;
            pointer-events: none;
        }

        .sim-overlay div {
            margin-bottom: var(--space-1);
        }

        .controls-panel {
            background: var(--color-white);
            border: 1px solid var(--color-gray-200);
            border-radius: var(--radius-xl);
            padding: var(--space-5);
        }

        .controls-panel h3 {
            font-size: 1.1rem;
            border-bottom: 2px solid var(--color-gray-100);
            padding-bottom: var(--space-2);
            margin-bottom: var(--space-4);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .control-section {
            margin-bottom: var(--space-5);
        }

        .control-section h4 {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--color-gray-500);
            margin-bottom: var(--space-3);
        }

        .control-group {
            margin-bottom: var(--space-3);
        }

        .control-group label {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: var(--space-1);
            color: var(--color-gray-700);
        }

        .control-value {
            font-family: 'Courier New', monospace;
            color: var(--color-accent);
            font-weight: 600;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            background: var(--color-gray-200);
            border-radius: 3px;
            appearance: none;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            background: var(--color-accent);
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid #fff;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            transition: transform 0.1s;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }

        .btn-row {
            display: flex;
            gap: var(--space-2);
            margin-top: var(--space-4);
        }

        .sim-btn {
            flex: 1;
            padding: var(--space-2);
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            border: none;
        }

        .sim-btn-primary {
            background: var(--color-accent);
            color: white;
        }

        .sim-btn-primary:hover {
            background: var(--color-accent-hover);
        }

        .sim-btn-secondary {
            background: var(--color-gray-200);
            color: var(--color-gray-700);
        }

        .sim-btn-secondary:hover {
            background: var(--color-gray-300);
        }

        .presets-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .preset-btn {
            background: var(--color-gray-100);
            border: 1px solid var(--color-gray-200);
            color: var(--color-gray-700);
            padding: 6px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
            text-align: center;
        }

        .preset-btn:hover,
        .preset-btn.active {
            border-color: var(--color-accent);
            background: var(--color-accent);
            color: white;
        }

        .info-card {
            background: var(--color-white);
            border: 1px solid var(--color-accent-light);
            border-left: 4px solid var(--color-accent);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-bottom: var(--space-6);
        }

        .info-card h3 {
            margin-bottom: var(--space-2);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--color-gray-800);
        }

        .info-card p {
            font-size: 0.95rem;
            color: var(--color-gray-600);
            line-height: 1.6;
            margin-bottom: 0.5rem;
        }

        /* Helper for hiding elements */
        .hidden {
            display: none !important;
        }
    </style>
</head>

<body>
    <!-- Nav -->
    <nav class="nav" id="nav">
        <div class="nav-content">
            <a href="../" class="nav-brand">
                <span>Mitchell</span>Hooymans
            </a>
            <ul class="nav-links">
                <li><a href="../">Home</a></li>
                <li><a href="../pages/about.html">About</a></li>
                <li><a href="../pages/resources.html" class="active">Resources</a></li>
                <li><a href="../pages/blog.html">Blog</a></li>
                <li><a href="../pages/photography.html">Photography</a></li>
                <li><a href="../pages/cv.html">CV</a></li>
                <li><a href="../pages/contact.html">Contact</a></li>
            </ul>
            <button class="nav-toggle" id="navToggle" aria-label="Toggle navigation">
                <span></span><span></span><span></span>
            </button>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <a href="../">Home</a>
        <a href="../pages/about.html">About</a>
        <a href="../pages/resources.html">Resources</a>
        <a href="../pages/blog.html">Blog</a>
        <a href="../pages/photography.html">Photography</a>
        <a href="../pages/cv.html">CV</a>
        <a href="../pages/contact.html">Contact</a>
    </div>

    <!-- Page Header -->
    <header class="page-header">
        <div class="container">
            <h1>Double Pendulum</h1>
            <p>Chaos theory in action</p>
        </div>
    </header>

    <section class="section">
        <div class="container">
            <a href="../pages/resources.html" class="back-link">
                <i class="fas fa-arrow-left"></i> Back to Resources
            </a>

            <div class="content-section">
                <!-- Info Card -->
                <div class="info-card">
                    <h3><i class="fas fa-info-circle"></i> Understanding the Chaos</h3>
                    <p>
                        The double pendulum is a classic example of a system that is <strong>deterministic yet
                            chaotic</strong>.
                        While the equations of motion (Lagrangian mechanics) are precisely defined, the system exhibits
                        extreme sensitivity to initial conditions.
                    </p>
                </div>

                <div class="simulation-wrapper">
                    <!-- Canvas -->
                    <div class="simulation-container">
                        <canvas id="simulationCanvas"></canvas>

                        <div class="sim-overlay">
                            <div>Total Energy: <span id="energyDisplay">0.00</span> J</div>
                        </div>
                    </div>

                    <!-- Controls -->
                    <div class="controls-panel">
                        <h3><i class="fas fa-sliders-h"></i> Configuration</h3>

                        <!-- Presets -->
                        <div class="control-section">
                            <h4>Presets</h4>
                            <div class="presets-grid">
                                <button class="preset-btn" data-preset="single">Single</button>
                                <button class="preset-btn" data-preset="double">Double</button>
                                <button class="preset-btn" data-preset="chaotic">Chaotic</button>
                                <button class="preset-btn" data-preset="balanced">Balanced</button>
                            </div>
                        </div>

                        <!-- System Parameters -->
                        <div class="control-section">
                            <h4>System</h4>
                            <div class="control-group">
                                <label>Gravity (g) <span id="gValue" class="control-value">9.81 m/s²</span></label>
                                <input type="range" id="gSlider" min="0" max="20" step="0.1" value="9.81">
                            </div>
                        </div>

                        <!-- Arm 1 Controls -->
                        <div class="control-section">
                            <h4>Arm 1 (Inner)</h4>
                            <div class="control-group">
                                <label>Length <span id="l1Value" class="control-value">1.0 m</span></label>
                                <input type="range" id="l1Slider" min="0.1" max="2.0" step="0.1" value="1.0">
                            </div>
                            <div class="control-group">
                                <label>Mass <span id="m1Value" class="control-value">1.0 kg</span></label>
                                <input type="range" id="m1Slider" min="0.1" max="5.0" step="0.1" value="1.0">
                            </div>
                            <div class="control-group">
                                <label>Angle <span id="a1Value" class="control-value">90°</span></label>
                                <input type="range" id="a1Slider" min="-180" max="180" step="1" value="90">
                            </div>
                        </div>

                        <!-- Arm 2 Controls -->
                        <div class="control-section" id="arm2Controls">
                            <h4>Arm 2 (Outer)</h4>
                            <div class="control-group">
                                <label>Length <span id="l2Value" class="control-value">1.0 m</span></label>
                                <input type="range" id="l2Slider" min="0.1" max="2.0" step="0.1" value="1.0">
                            </div>
                            <div class="control-group">
                                <label>Mass <span id="m2Value" class="control-value">1.0 kg</span></label>
                                <input type="range" id="m2Slider" min="0.0" max="5.0" step="0.1" value="1.0">
                            </div>
                            <div class="control-group">
                                <label>Angle <span id="a2Value" class="control-value">90°</span></label>
                                <input type="range" id="a2Slider" min="-180" max="180" step="1" value="90">
                            </div>
                        </div>

                        <hr style="border-color: var(--color-gray-200); margin: 20px 0;">

                        <!-- Display -->
                        <div class="control-section">
                            <h4>Simulation</h4>
                            <div class="control-group">
                                <label>Speed <span id="speedValue" class="control-value">1.00x</span></label>
                                <input type="range" id="speedSlider" min="0.1" max="4.0" step="0.1" value="1.0">
                            </div>
                            <div class="control-group">
                                <label>Trail <span id="trailValue" class="control-value">500</span></label>
                                <input type="range" id="trailSlider" min="0" max="2000" step="50" value="500">
                            </div>
                        </div>

                        <div class="btn-row">
                            <button class="sim-btn sim-btn-primary" id="playPauseBtn">
                                <i class="fas fa-pause"></i> Pause
                            </button>
                            <button class="sim-btn sim-btn-secondary" id="resetBtn">
                                <i class="fas fa-redo"></i> Reset
                            </button>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div>
                    <div class="footer-brand">Mitchell Hooymans</div>
                    <p class="footer-tagline">Astrophysicist & STEM Communicator</p>
                </div>
                <!-- ... Social Links ... -->
                <div class="social-links">
                    <a href="https://www.linkedin.com/in/mitchell-hooymans/" class="social-link" aria-label="LinkedIn"
                        target="_blank">
                        <i class="fab fa-linkedin-in"></i>
                    </a>
                    <a href="https://github.com/mitchellhooymans" class="social-link" aria-label="GitHub"
                        target="_blank">
                        <i class="fab fa-github"></i>
                    </a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 Mitchell Hooymans. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // ========================================
        // Navigation Setup
        // ========================================
        const nav = document.getElementById('nav');
        const navToggle = document.getElementById('navToggle');
        const mobileMenu = document.getElementById('mobileMenu');

        window.addEventListener('scroll', () => {
            nav.classList.toggle('scrolled', window.scrollY > 20);
        });

        navToggle.addEventListener('click', () => {
            mobileMenu.classList.toggle('open');
        });

        // ========================================
        // Simulation Setup
        // ========================================
        const canvas = document.getElementById('simulationCanvas');
        const ctx = canvas.getContext('2d');

        function setupCanvas() {
            const rect = canvas.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
        }
        setupCanvas();
        window.addEventListener('resize', setupCanvas);

        // ========================================
        // Physics State
        // ========================================
        let isPlaying = true;

        let theta1 = Math.PI / 2;
        let theta2 = Math.PI / 2;
        let omega1 = 0;
        let omega2 = 0;

        let g = 9.81;
        let l1 = 1.0;
        let l2 = 1.0;
        let m1 = 1.0;
        let m2 = 1.0;

        let trailLength = 500;
        let trail = [];
        let timeScale = 1.0;

        // Rendering scale
        const SCALE_BASE = 150;

        // ========================================
        // Physics Logic (Lagrangian)
        // ========================================
        function getDerivatives(t1, t2, w1, w2) {
            // Check if M2 is effectively zero (Single Pendulum Mode)
            if (m2 <= 0.001) {
                return {
                    dt1: w1,
                    dt2: 0,
                    dw1: -(g / l1) * Math.sin(t1),
                    dw2: 0
                };
            }

            const num1 = -g * (2 * m1 + m2) * Math.sin(t1) - m2 * g * Math.sin(t1 - 2 * t2) - 2 * Math.sin(t1 - t2) * m2 * (w2 * w2 * l2 + w1 * w1 * l1 * Math.cos(t1 - t2));
            const den1 = l1 * (2 * m1 + m2 - m2 * Math.cos(2 * t1 - 2 * t2));

            const num2 = 2 * Math.sin(t1 - t2) * (w1 * w1 * l1 * (m1 + m2) + g * (m1 + m2) * Math.cos(t1) + w2 * w2 * l2 * m2 * Math.cos(t1 - t2));
            const den2 = l2 * (2 * m1 + m2 - m2 * Math.cos(2 * t1 - 2 * t2));

            return {
                dt1: w1,
                dt2: w2,
                dw1: num1 / den1,
                dw2: num2 / den2
            };
        }

        function rk4(dt) {
            let d = getDerivatives(theta1, theta2, omega1, omega2);
            let k1_t1 = d.dt1 * dt, k1_t2 = d.dt2 * dt, k1_w1 = d.dw1 * dt, k1_w2 = d.dw2 * dt;

            d = getDerivatives(theta1 + k1_t1 / 2, theta2 + k1_t2 / 2, omega1 + k1_w1 / 2, omega2 + k1_w2 / 2);
            let k2_t1 = d.dt1 * dt, k2_t2 = d.dt2 * dt, k2_w1 = d.dw1 * dt, k2_w2 = d.dw2 * dt;

            d = getDerivatives(theta1 + k2_t1 / 2, theta2 + k2_t2 / 2, omega1 + k2_w1 / 2, omega2 + k2_w2 / 2);
            let k3_t1 = d.dt1 * dt, k3_t2 = d.dt2 * dt, k3_w1 = d.dw1 * dt, k3_w2 = d.dw2 * dt;

            d = getDerivatives(theta1 + k3_t1, theta2 + k3_t2, omega1 + k3_w1, omega2 + k3_w2);
            let k4_t1 = d.dt1 * dt, k4_t2 = d.dt2 * dt, k4_w1 = d.dw1 * dt, k4_w2 = d.dw2 * dt;

            theta1 += (k1_t1 + 2 * k2_t1 + 2 * k3_t1 + k4_t1) / 6;
            theta2 += (k1_t2 + 2 * k2_t2 + 2 * k3_t2 + k4_t2) / 6;
            omega1 += (k1_w1 + 2 * k2_w1 + 2 * k3_w1 + k4_w1) / 6;
            omega2 += (k1_w2 + 2 * k2_w2 + 2 * k3_w2 + k4_w2) / 6;
        }

        function computeEnergy() {
            // T
            const v1sq = (l1 * omega1) ** 2;
            const v2sq = (l1 * omega1) ** 2 + (l2 * omega2) ** 2 + 2 * l1 * l2 * omega1 * omega2 * Math.cos(theta1 - theta2);
            const T = 0.5 * m1 * v1sq + 0.5 * m2 * v2sq;

            // V (Zero at pivot)
            const y1 = -l1 * Math.cos(theta1);
            const y2 = -l1 * Math.cos(theta1) - l2 * Math.cos(theta2);
            const V = m1 * g * y1 + m2 * g * y2;

            // Shift to lowest point so E > 0 usually
            const lowest = -(m1 * l1 + m2 * (l1 + l2)) * g;
            // Actually just return T + V relative to pivot
            return T + V;
        }

        // ========================================
        // Rendering
        // ========================================
        function toScreen(x, y) {
            const W = canvas.getBoundingClientRect().width;
            const H = canvas.getBoundingClientRect().height;
            const cx = W / 2;
            const cy = H * 0.5; // Center vertically

            // Adjust scale based on total length to fit screen
            // Total span is roughly 2*(l1+l2). We want this to fit in H with margin.
            // We want radius to be ~40% of height (total diameter 80%), leaving 10% margin top/bottom.

            const totalLen = Math.max(1, l1 + l2);
            const scale = (Math.min(W, H) * 0.4) / totalLen;

            return {
                sx: cx + x * scale,
                sy: cy + y * scale
            };
        }

        function render() {
            const W = canvas.getBoundingClientRect().width;
            const H = canvas.getBoundingClientRect().height;

            ctx.fillStyle = '#050510'; // Or gradient
            // Redraw background cleaner
            ctx.clearRect(0, 0, W, H);
            const grd = ctx.createRadialGradient(W / 2, H / 2, 0, W / 2, H / 2, Math.max(W, H));
            grd.addColorStop(0, '#1a1a2e');
            grd.addColorStop(1, '#050510');
            ctx.fillStyle = grd;
            ctx.fillRect(0, 0, W, H);

            const pivot = toScreen(0, 0);
            const x1 = l1 * Math.sin(theta1);
            const y1 = l1 * Math.cos(theta1);
            const x2 = x1 + l2 * Math.sin(theta2);
            const y2 = y1 + l2 * Math.cos(theta2);
            const p1 = toScreen(x1, y1);
            const p2 = toScreen(x2, y2);

            // Trail
            if (trail.length > 1) {
                ctx.beginPath();
                ctx.strokeStyle = '#3b82f6';
                ctx.lineWidth = 2;
                for (let i = 0; i < trail.length - 1; i++) {
                    const pt1 = toScreen(trail[i].x, trail[i].y);
                    const pt2 = toScreen(trail[i + 1].x, trail[i + 1].y);
                    ctx.moveTo(pt1.sx, pt1.sy);
                    ctx.lineTo(pt2.sx, pt2.sy);
                }
                ctx.stroke();
            }

            // Rods
            ctx.strokeStyle = '#94a3b8';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(pivot.sx, pivot.sy);
            ctx.lineTo(p1.sx, p1.sy);
            if (m2 > 0.001) ctx.lineTo(p2.sx, p2.sy);
            ctx.stroke();

            // Pivot
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.arc(pivot.sx, pivot.sy, 4, 0, Math.PI * 2);
            ctx.fill();

            // Mass 1
            ctx.fillStyle = '#e2e8f0';
            ctx.beginPath();
            ctx.arc(p1.sx, p1.sy, 8 + m1 * 2, 0, Math.PI * 2);
            ctx.fill();

            // Mass 2
            if (m2 > 0.001) {
                ctx.fillStyle = '#3b82f6';
                ctx.beginPath();
                ctx.arc(p2.sx, p2.sy, 8 + m2 * 2, 0, Math.PI * 2);
                ctx.fill();
            }

            // Energy offset
            const E = computeEnergy();
            // We shift display energy to be relative to lowest point for "positive" vibes?
            // Or just raw physics. Raw physics is negative sometimes. 
            // Let's just show raw.
            document.getElementById('energyDisplay').textContent = E.toFixed(2);
        }

        // ========================================
        // Loop
        // ========================================
        let lastTime = 0;
        function loop(timestamp) {
            const dt = Math.min((timestamp - lastTime) / 1000, 0.05);
            lastTime = timestamp;

            if (isPlaying) {
                const subSteps = 10;
                const physicsDt = (dt * timeScale) / subSteps;
                for (let i = 0; i < subSteps; i++) rk4(physicsDt);

                const x1 = l1 * Math.sin(theta1);
                const y1 = l1 * Math.cos(theta1);
                const x2 = x1 + l2 * Math.sin(theta2);
                const y2 = y1 + l2 * Math.cos(theta2);

                // If Single pendulum (m2=0), track m1
                if (m2 <= 0.001) {
                    trail.push({ x: x1, y: y1 });
                } else {
                    trail.push({ x: x2, y: y2 });
                }

                if (trail.length > trailLength) trail.shift();
            }

            render();
            requestAnimationFrame(loop);
        }

        // ========================================
        // Controls
        // ========================================
        const presets = {
            'double': { l1: 1, l2: 1, m1: 1, m2: 1, a1: 90, a2: 90, g: 9.81 },
            'single': { l1: 1.5, l2: 0.1, m1: 2, m2: 0, a1: 45, a2: 0, g: 9.81 },
            'chaotic': { l1: 1, l2: 1, m1: 1, m2: 1, a1: 90, a2: -90, g: 9.81 },
            'balanced': { l1: 1, l2: 1, m1: 1, m2: 1, a1: 179, a2: 179, g: 9.81 }
        };

        function updateUI() {
            document.getElementById('gValue').textContent = g.toFixed(2) + ' m/s²';
            document.getElementById('l1Value').textContent = l1.toFixed(1) + ' m';
            document.getElementById('l2Value').textContent = l2.toFixed(1) + ' m';
            document.getElementById('m1Value').textContent = m1.toFixed(1) + ' kg';
            document.getElementById('m2Value').textContent = m2.toFixed(1) + ' kg';

            // Convert rad to deg for display
            const d1 = Math.round(theta1 * 180 / Math.PI);
            // Warning: theta changes during sim, but sliders control INITIAL angle?
            // Usually sliders should update while playing? No, that's messy.
            // Let's have sliders ONLY control initial state or restart.
            // For now, sliders read from INPUTS.

            // Wait, we need to distinguish "Current State" vs "Input Value".
            // Let's just update the TEXT labels from the SLIDER values.

            const s_l1 = parseFloat(document.getElementById('l1Slider').value);
            const s_l2 = parseFloat(document.getElementById('l2Slider').value);
            const s_m1 = parseFloat(document.getElementById('m1Slider').value);
            const s_m2 = parseFloat(document.getElementById('m2Slider').value);
            const s_g = parseFloat(document.getElementById('gSlider').value);
            const s_a1 = parseFloat(document.getElementById('a1Slider').value);
            const s_a2 = parseFloat(document.getElementById('a2Slider').value);

            document.getElementById('l1Value').textContent = s_l1.toFixed(1) + ' m';
            document.getElementById('l2Value').textContent = s_l2.toFixed(1) + ' m';
            document.getElementById('m1Value').textContent = s_m1.toFixed(1) + ' kg';
            document.getElementById('m2Value').textContent = s_m2.toFixed(1) + ' kg';
            document.getElementById('gValue').textContent = s_g.toFixed(2) + ' m/s²';
            document.getElementById('a1Value').textContent = s_a1 + '°';
            document.getElementById('a2Value').textContent = s_a2 + '°';

            document.getElementById('speedValue').textContent = timeScale.toFixed(2) + 'x';
            document.getElementById('trailValue').textContent = trailLength;
        }

        function applyControls() {
            g = parseFloat(document.getElementById('gSlider').value);
            l1 = parseFloat(document.getElementById('l1Slider').value);
            l2 = parseFloat(document.getElementById('l2Slider').value);
            m1 = parseFloat(document.getElementById('m1Slider').value);
            m2 = parseFloat(document.getElementById('m2Slider').value);
            timeScale = parseFloat(document.getElementById('speedSlider').value);
            trailLength = parseInt(document.getElementById('trailSlider').value);

            updateUI();
        }

        function resetSim() {
            // Force browser to nuke canvas buffer
            setupCanvas();

            applyControls();

            const a1 = parseFloat(document.getElementById('a1Slider').value);
            const a2 = parseFloat(document.getElementById('a2Slider').value);
            theta1 = a1 * Math.PI / 180;
            theta2 = a2 * Math.PI / 180;
            omega1 = 0;
            omega2 = 0;
            omega1 = 0;
            omega2 = 0;
            trail.length = 0; // Explicitly empty array
        }

        // Listeners
        ['gSlider', 'l1Slider', 'l2Slider', 'm1Slider', 'm2Slider'].forEach(id => {
            document.getElementById(id).addEventListener('input', applyControls);
        });

        ['speedSlider', 'trailSlider'].forEach(id => {
            document.getElementById(id).addEventListener('input', applyControls);
        });

        ['a1Slider', 'a2Slider'].forEach(id => {
            document.getElementById(id).addEventListener('input', resetSim); // Reset on angle change
        });

        document.getElementById('playPauseBtn').addEventListener('click', () => {
            isPlaying = !isPlaying;
            document.getElementById('playPauseBtn').innerHTML = isPlaying
                ? '<i class="fas fa-pause"></i> Pause'
                : '<i class="fas fa-play"></i> Play';
        });

        document.getElementById('resetBtn').addEventListener('click', resetSim);

        // Presets
        document.querySelectorAll('.preset-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const pName = btn.dataset.preset;
                const p = presets[pName];

                // Highlight
                document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                // Dynamic Hiding
                const arm2 = document.getElementById('arm2Controls');
                if (pName === 'single') {
                    arm2.classList.add('hidden');
                } else {
                    arm2.classList.remove('hidden');
                }

                if (p) {
                    document.getElementById('gSlider').value = p.g;
                    document.getElementById('l1Slider').value = p.l1;
                    document.getElementById('l2Slider').value = p.l2;
                    document.getElementById('m1Slider').value = p.m1;
                    document.getElementById('m2Slider').value = p.m2;
                    document.getElementById('a1Slider').value = p.a1;
                    document.getElementById('a2Slider').value = p.a2;
                    resetSim();
                }
            });
        });

        // Initialize
        document.querySelector('.preset-btn[data-preset="single"]').click();
        requestAnimationFrame(loop);

    </script>
</body>

</html>